"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[8425],{128:(n,e,s)=>{s.d(e,{A:()=>i});const i=s.p+"assets/images/stat-f857945bc69dd4c88edb213aa7f008d1.png"},5102:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"sysmon-splunk/installation/installation","title":"Lab setup","description":"Lab overview","source":"@site/docs/sysmon-splunk/installation/installation.mdx","sourceDirName":"sysmon-splunk/installation","slug":"/sysmon-splunk/installation/","permalink":"/my-small-blog/docs/sysmon-splunk/installation/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tags":[]},"sidebar":"tutorialSidebar","previous":{"title":"Sysmon & Splunk","permalink":"/my-small-blog/docs/category/sysmon--splunk"},"next":{"title":"Detecting suspicious file operations in critical Windows directories","permalink":"/my-small-blog/docs/sysmon-splunk/integrity/"}}');var r=s(4848),l=s(8453);const t={tags:[]},o="Lab setup",d={},c=[{value:"Lab overview",id:"lab-overview",level:2},{value:"Lab topology",id:"lab-topology",level:2},{value:"Installing Splunk Enterprise on Ubuntu Server",id:"installing-splunk-enterprise-on-ubuntu-server",level:2},{value:"Installing Splunk Universal Forwarder on Windows",id:"installing-splunk-universal-forwarder-on-windows",level:2},{value:"Installing Sysmon on Windows",id:"installing-sysmon-on-windows",level:2}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"lab-setup",children:"Lab setup"})}),"\n",(0,r.jsx)(e.h2,{id:"lab-overview",children:"Lab overview"}),"\n",(0,r.jsxs)(e.p,{children:["In this lab, we're building a simple network monitoring setup using ",(0,r.jsx)(e.strong,{children:"Splunk Enterprise"}),", ",(0,r.jsx)(e.strong,{children:"Splunk Universal Forwarder"}),", and ",(0,r.jsx)(e.strong,{children:"Sysmon"}),".\r\nThe goal is to collect and analyze Windows event logs, including detailed system activity via Sysmon, using Splunk on a centralized Ubuntu server."]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"lab-topology",children:"Lab topology"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Role"}),(0,r.jsx)(e.th,{children:"OS"}),(0,r.jsx)(e.th,{children:"IP Address"}),(0,r.jsx)(e.th,{children:"Description"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Server"}),(0,r.jsx)(e.td,{children:"Ubuntu Server"}),(0,r.jsx)(e.td,{children:"192.168.200.3/24"}),(0,r.jsx)(e.td,{children:"Splunk Enterprise Server"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Victim/User"}),(0,r.jsx)(e.td,{children:"Windows"}),(0,r.jsx)(e.td,{children:"192.168.200.4/24"}),(0,r.jsx)(e.td,{children:"Splunk Universal Forwarder"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Attacker"}),(0,r.jsx)(e.td,{children:"Kali Linux"}),(0,r.jsx)(e.td,{children:"192.168.200.5/24"}),(0,r.jsx)(e.td,{children:"C2 Server (Simulated Attacker)"})]})]})]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"installing-splunk-enterprise-on-ubuntu-server",children:"Installing Splunk Enterprise on Ubuntu Server"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Download the .deb package ",(0,r.jsx)(e.a,{href:"https://www.splunk.com/en_us/download/splunk-enterprise.html",children:"here"}),"."]}),"\n",(0,r.jsx)(e.li,{children:"Install Splunk:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"sudo apt install ./<splunk-package>.deb\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Start Splunk and accept the license:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"sudo /opt/splunk/bin/splunk start --accept-license\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Set up the admin account and login at ",(0,r.jsx)(e.code,{children:"http://192.168.200.3:8000"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["Create 3 indexes:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Navigate to ",(0,r.jsx)(e.code,{children:"Settings"})," > ",(0,r.jsx)(e.code,{children:"Indexes"})," > ",(0,r.jsx)(e.code,{children:"New Index"})]}),"\n",(0,r.jsxs)(e.li,{children:["Create the following indexes: ",(0,r.jsx)(e.code,{children:"sysmon_logs"}),", ",(0,r.jsx)(e.code,{children:"security_events"}),", ",(0,r.jsx)(e.code,{children:"windows_system_logs"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"installing-splunk-universal-forwarder-on-windows",children:"Installing Splunk Universal Forwarder on Windows"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Download the installer ",(0,r.jsx)(e.a,{href:"https://www.splunk.com/en_us/download/universal-forwarder.html",children:"here"})]}),"\n",(0,r.jsx)(e.li,{children:"Install and create an admin account."}),"\n",(0,r.jsxs)(e.li,{children:["Configure the forwarder to connect with Splunk Enterprise:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Open cmd as Administrator and run:"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'cd "C:\\Program Files\\SplunkUniversalForwarder\\bin"\r\nsplunk enable boot-start\r\nsplunk start\r\nsplunk add forward-server 192.168.200.3:9997 -auth username:password\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Add event log monitors:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'splunk add monitor "C:\\Windows\\System32\\winevt\\Logs\\Security.evtx"\r\nsplunk add monitor "C:\\Windows\\System32\\winevt\\Logs\\Application.evtx"\r\nsplunk add monitor "C:\\Windows\\System32\\winevt\\Logs\\System.evtx"\r\nsplunk add monitor "C:\\Windows\\System32\\winevt\\Logs\\Microsoft-Windows-Sysmon%4Operational.evtx"\r\nsplunk restart\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Configure inputs.conf:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Navigate to ",(0,r.jsx)(e.code,{children:"C:\\Program Files\\SplunkUniversalForwarder\\etc\\system\\local"})]}),"\n",(0,r.jsxs)(e.li,{children:["Create or edit ",(0,r.jsx)(e.code,{children:"inputs.conf"})," with the following content:"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"[WinEventLog://Security]\r\ndisabled = false\r\nindex = security_events\r\nsourcetype = WinEventLog:Security\r\n\r\n[WinEventLog://Application]\r\ndisabled = false\r\nindex = windows_system_logs\r\nsourcetype = WinEventLog:Application\r\n\r\n[WinEventLog://System]\r\ndisabled = false\r\nindex = windows_system_logs\r\nsourcetype = WinEventLog:System\r\n\r\n[WinEventLog://Microsoft-Windows-Sysmon/Operational]\r\ndisabled = false\r\nrenderXml = true\r\nindex = sysmon_logs\r\nsource = XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Restart the forwarder"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"splunk restart\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Verify Splunk Forwarder Service Account:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'Get-WmiObject win32_service | Where-Object { $_.Name -eq "SplunkForwarder" } | Select-Object StartName\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["If not running as ",(0,r.jsx)(e.strong,{children:"LocalSystem"}),":","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Open ",(0,r.jsx)(e.code,{children:"services.msc"})]}),"\n",(0,r.jsx)(e.li,{children:"Locate SplunkForwarder"}),"\n",(0,r.jsx)(e.li,{children:"Right-click \u2192 Properties \u2192 Log On tab"}),"\n",(0,r.jsx)(e.li,{children:"Select Local System account"}),"\n",(0,r.jsx)(e.li,{children:"Restart the service"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["Enable Receiving on Splunk Enterprise:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Go to ",(0,r.jsx)(e.code,{children:"Settings"})," > ",(0,r.jsx)(e.code,{children:"Forwarding and Receiving"})," > ",(0,r.jsx)(e.code,{children:"Configure Receiving"})]}),"\n",(0,r.jsxs)(e.li,{children:["Add port ",(0,r.jsx)(e.strong,{children:"9997"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["Go to ",(0,r.jsx)(e.strong,{children:"Search & Reporting"})," dashboard and run:"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'index="*" | stats count by sourcetype\n'})}),"\n",(0,r.jsx)(e.p,{children:"This verifies data is being received."}),"\n",(0,r.jsx)("div",{style:{width:"100%",margin:"0 auto"},children:(0,r.jsx)("img",{src:s(128).A,style:{width:"100%",height:"auto"}})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"installing-sysmon-on-windows",children:"Installing Sysmon on Windows"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Download ",(0,r.jsx)(e.a,{href:"https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon",children:"Sysmon"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:["Get a configuration file at ",(0,r.jsx)(e.a,{href:"https://github.com/SwiftOnSecurity/sysmon-config/blob/master/sysmonconfig-export.xml",children:"SwiftOnSecurity Sysmon Config"}),"."]}),"\n",(0,r.jsx)(e.li,{children:"Install Sysmon with config:"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"sysmon.exe -i sysmonconfig-export.xml\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Verify logs:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Open ",(0,r.jsx)(e.strong,{children:"Event Viewer"})]}),"\n",(0,r.jsxs)(e.li,{children:["Navigate to ",(0,r.jsx)(e.code,{children:"Applications and Services Logs"})," > ",(0,r.jsx)(e.code,{children:"Microsoft"})," > ",(0,r.jsx)(e.code,{children:"Windows"})," > ",(0,r.jsx)(e.code,{children:"Sysmon"})," > ",(0,r.jsx)(e.code,{children:"Operational"})]}),"\n",(0,r.jsx)(e.li,{children:"Ensure logs are being generated and Sysmon is running properly."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)("div",{style:{width:"100%",margin:"0 auto"},children:(0,r.jsx)("img",{src:s(6485).A,style:{width:"100%",height:"auto"}})}),"\n",(0,r.jsx)(e.p,{children:"With this setup, you're now collecting and forwarding critical Windows logs and Sysmon data to a centralized Splunk instance. This foundation can be expanded into more complex threat detection and monitoring use cases in future labs."})]})}function h(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},6485:(n,e,s)=>{s.d(e,{A:()=>i});const i=s.p+"assets/images/syslog-79ce60c0f819d8d59230f46277a971ba.png"},8453:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function t(n){const e=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);