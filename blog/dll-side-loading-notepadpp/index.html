<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Exploring DLL Side Loading: A practical walkthrough using Notepad++ | solivaquaant</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://solivaquaant.github.io/my-small-blog/img/avt.png"><meta data-rh="true" name="twitter:image" content="https://solivaquaant.github.io/my-small-blog/img/avt.png"><meta data-rh="true" property="og:url" content="https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Exploring DLL Side Loading: A practical walkthrough using Notepad++ | solivaquaant"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-05-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/solivaquaant"><meta data-rh="true" property="article:tag" content="Malware"><link data-rh="true" rel="icon" href="/my-small-blog/img/avt-trans.png"><link data-rh="true" rel="canonical" href="https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp"><link data-rh="true" rel="alternate" href="https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp" hreflang="en"><link data-rh="true" rel="alternate" href="https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp","mainEntityOfPage":"https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp","url":"https://solivaquaant.github.io/my-small-blog/blog/dll-side-loading-notepadpp","headline":"Exploring DLL Side Loading: A practical walkthrough using Notepad++","name":"Exploring DLL Side Loading: A practical walkthrough using Notepad++","description":"Blog","datePublished":"2025-05-03T00:00:00.000Z","author":{"@type":"Person","name":"Thai Trinh","description":"Cybersecurity Student @ UIT","url":"https://github.com/solivaquaant","image":"/my-small-blog/img/avt-trans.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://solivaquaant.github.io/my-small-blog/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/my-small-blog/blog/rss.xml" title="solivaquaant RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-small-blog/blog/atom.xml" title="solivaquaant Atom Feed"><link rel="stylesheet" href="/my-small-blog/assets/css/styles.5b1d9f5e.css">
<script src="/my-small-blog/assets/js/runtime~main.6984d542.js" defer="defer"></script>
<script src="/my-small-blog/assets/js/main.3a778a38.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/my-small-blog/img/jumping-avt.gif"><link rel="preload" as="image" href="/my-small-blog/img/avt-trans.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/procmon-69ff9d3520c76e073e65fdf0649e1971.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/error-0650988fa04da984ad51f23913a333b7.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/dumpbin-ad88fb454be97c973fe163e92ba34747.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/x64-c579ea745d1dde9edb2be3a86832d338.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/proxy-41f564dc318311c3925a0817f77b411f.png"><link rel="preload" as="image" href="/my-small-blog/assets/images/c2-50e87282a02b29ba3c2fc013d4914c2b.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-small-blog/"><div class="navbar__logo"><img src="/my-small-blog/img/jumping-avt.gif" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/my-small-blog/img/jumping-avt.gif" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Welcome</b></a><a class="navbar__item navbar__link" href="/my-small-blog/docs/about-me/">  Write-ups</a><a class="navbar__item navbar__link" docid="intro" href="/my-small-blog/labs/intro">Labs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/my-small-blog/blog">Blogs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/solivaquaant" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-small-blog/blog/yt-dlp">A few handy tips for downloading videos with yt-dlp</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-small-blog/blog/typed-paths">A deep dive into Windows TypedPaths</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/my-small-blog/blog/dll-side-loading-notepadpp">Exploring DLL Side Loading: A practical walkthrough using Notepad++</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/my-small-blog/blog/nt334-lab2-ctf">Stego secrets: Extracting embedded files using HxD and dd</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Exploring DLL Side Loading: A practical walkthrough using Notepad++</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-05-03T00:00:00.000Z">May 3, 2025</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/my-small-blog/blog/authors/tndt"><img class="avatar__photo authorImage_XqGP" src="/my-small-blog/img/avt-trans.png" alt="Thai Trinh"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/my-small-blog/blog/authors/tndt"><span class="authorName_yefp" translate="no">Thai Trinh</span></a></div><small class="authorTitle_nd0D" title="Cybersecurity Student @ UIT">Cybersecurity Student @ UIT</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>In today&#x27;s blog post, we&#x27;re diving into DLL Side Loading - a technique often exploited by attackers to execute malicious code by abusing the way Windows searches for and loads dynamic link libraries.
We&#x27;ll break down how DLL Side Loading works, how the Windows DLL search order contributes to the vulnerability, and walk through a practical example using Notepad++ as our target application.</p>
<!-- -->
<blockquote>
<p>⚠️ Disclaimer<br>
<!-- -->This article is for <strong>educational</strong> and <strong>ethical</strong> purposes only.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-dlls-and-dll-side-loading">Understanding DLLs and DLL Side Loading<a href="#understanding-dlls-and-dll-side-loading" class="hash-link" aria-label="Direct link to Understanding DLLs and DLL Side Loading" title="Direct link to Understanding DLLs and DLL Side Loading" translate="no">​</a></h2>
<p><strong>Dynamic link libraries (DLLs)</strong> are modular components that contain code and data used by multiple programs simultaneously.
DLLs help reduce redundancy and optimize memory usage across Windows systems.</p>
<p><strong>DLL side loading</strong> is a technique where an attacker places a malicious DLL in a location where a legitimate application may inadvertently load it instead of the intended one.
This often happens due to the <strong>Windows DLL search order</strong>, which prioritizes certain directories (like the application&#x27;s folder) over system directories when loading libraries.
By exploiting this search behavior, attackers can trick applications into executing their malicious payloads without modifying the target application itself.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="tools--setup">Tools &amp; setup<a href="#tools--setup" class="hash-link" aria-label="Direct link to Tools &amp; setup" title="Direct link to Tools &amp; setup" translate="no">​</a></h2>
<p>For this walkthrough, we&#x27;ll be using the following tools and setup:</p>
<ul>
<li class="">Target: Notepad++ v8.7.7</li>
<li class="">ProcMon (Sysinternals): Monitor DLL loading and process activity</li>
<li class="">x64dbg: Reverse-engineering and binary analysis</li>
<li class="">Visual Studio: Compile our custom DLLs</li>
<li class="">Sliver C2: Open-source C2 framework</li>
</ul>
<p>Environment:</p>
<ul>
<li class="">Victim: Windows 10/11</li>
<li class="">Attacker: Kali Linux</li>
<li class="">Network: NAT (VMware)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="case-study-gupexe-in-notepad">Case study: GUP.exe in Notepad++<a href="#case-study-gupexe-in-notepad" class="hash-link" aria-label="Direct link to Case study: GUP.exe in Notepad++" title="Direct link to Case study: GUP.exe in Notepad++" translate="no">​</a></h2>
<p>Notepad++ ships with an updater utility called <strong>GUP.exe (Generic Updater)</strong>.
It typically resides in <code>C:\Program Files\Notepad++\updater\GUP.exe</code>.
This executable checks for and installs updates for Notepad++ or its plugins.
When run, it prompts a software update popup and loads several files from its directory, including:</p>
<ul>
<li class=""><code>GUP.exe</code></li>
<li class=""><code>libcurl.dll</code> -a dynamic library from the cURL project for network communication</li>
<li class=""><code>gup.xml</code> - configuration file for update behavior</li>
</ul>
<p>By using <strong>ProcMon</strong>, we observe that <code>GUP.exe</code> loads <code>libcurl.dll</code> from the local directory, making it an <em>ideal</em> candidate for DLL Side Loading.</p>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/procmon-69ff9d3520c76e073e65fdf0649e1971.png" style="width:100%;height:auto"></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="crafting-the-first-malicious-dll">Crafting the first malicious DLL<a href="#crafting-the-first-malicious-dll" class="hash-link" aria-label="Direct link to Crafting the first malicious DLL" title="Direct link to Crafting the first malicious DLL" translate="no">​</a></h2>
<p>To test the loading behavior, we create a simple malicious <code>libcurl.dll</code> with a MessageBox payload:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BOOL APIENTRY </span><span class="token function" style="color:#d73a49">DllMain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HMODULE hModule</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DWORD  ul_reason_for_call</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LPVOID lpReserved</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ul_reason_for_call</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> DLL_PROCESS_ATTACH</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">MessageBoxA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Group-CK13&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Simple DLL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MB_OK </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> MB_ICONEXCLAMATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> TRUE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Replace the original <code>libcurl.dll</code> with our malicious version and execute <code>GUP.exe</code>.
We notice 2 things in <strong>ProcMon</strong>:</p>
<ul>
<li class="">Our malicious DLL was successfully loaded</li>
<li class="">GUP.exe crashes due to missing exported functions like <code>curl_easy_setopt</code></li>
</ul>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/error-0650988fa04da984ad51f23913a333b7.png" style="width:100%;height:auto"></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="identifying-and-exporting-required-functions">Identifying and exporting required functions<a href="#identifying-and-exporting-required-functions" class="hash-link" aria-label="Direct link to Identifying and exporting required functions" title="Direct link to Identifying and exporting required functions" translate="no">​</a></h2>
<p>The crash occurs because <code>GUP.exe</code> expects <code>libcurl.dll</code> to expose certain functions, which our malicious DLL lacks.
To identify them, use <code>dumpbin /IMPORTS GUP.exe</code> in the Visual Studio command prompt to inspect the <strong>Import Address Table (IAT)</strong>:</p>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/dumpbin-ad88fb454be97c973fe163e92ba34747.png" style="width:100%;height:auto"></div>
<p>You&#x27;ll find it imports these 4 functions: <code>curl_easy_init</code>, <code>curl_easy_setopt</code>, <code>curl_easy_cleanup</code>, <code>curl_easy_perform</code></p>
<p>We modify our DLL to export these functions, with <code>curl_easy_init</code> triggering our MessageBox:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__declspec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dllexport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> PVOID </span><span class="token function" style="color:#d73a49">curl_easy_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MessageBoxA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Group-CK13&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Simple DLL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MB_OK </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> MB_ICONEXCLAMATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__declspec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dllexport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> PVOID </span><span class="token function" style="color:#d73a49">curl_easy_setopt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__declspec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dllexport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> PVOID </span><span class="token function" style="color:#d73a49">curl_easy_cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__declspec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dllexport</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> PVOID </span><span class="token function" style="color:#d73a49">curl_easy_perform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Now, when running <code>GUP.exe</code>, we see the MessageBox as intended.</p>
<div style="width:60%;margin:0 auto"><img src="data:image/png;base64,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" style="width:100%;height:auto"></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="combining-with-dll-proxying-for-stealth-and-functionality">Combining with DLL proxying for stealth and functionality<a href="#combining-with-dll-proxying-for-stealth-and-functionality" class="hash-link" aria-label="Direct link to Combining with DLL proxying for stealth and functionality" title="Direct link to Combining with DLL proxying for stealth and functionality" translate="no">​</a></h2>
<p>However, if we proceed as described above, when the user runs GUP.exe (or updates Notepad++),
they will not see the original Message Box of the application and will not be able to perform the original functionality.</p>
<p>Therefore, we combine this with the <strong>DLL proxying</strong> technique - a method used to intercept function calls that are originally directed to a legitimate DLL file.
This is done by creating an intermediary DLL, called a Proxy DLL, which exports the same functions as the original DLL.</p>
<p>Steps:</p>
<ol>
<li class="">Rename the original DLL file to <code>gup.dll</code></li>
<li class="">Add the following <code>#pragma</code> comment directives:</li>
</ol>
<ul>
<li class="">These are linker directives used to export functions just like the original DLL, but in fact, they forward the calls to the real DLL, which is now <code>gup.dll</code></li>
<li class="">Syntax: <code>/export:function_name=originalDLL.function_name,@ordinal</code></li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">pragma</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">comment</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">linker</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;/export:curl_easy_cleanup=gup.curl_easy_cleanup,@1&quot;</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">pragma</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">comment</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">linker</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;/export:curl_easy_init=gup.curl_easy_init,@6&quot;</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">pragma</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">comment</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">linker</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;/export:curl_easy_perform=gup.curl_easy_perform,@12&quot;</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">pragma</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression function" style="color:#d73a49">comment</span><span class="token macro property expression punctuation" style="color:#393A34">(</span><span class="token macro property expression" style="color:#36acaa">linker</span><span class="token macro property expression punctuation" style="color:#393A34">,</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;/export:curl_easy_setopt=gup.curl_easy_setopt,@16&quot;</span><span class="token macro property expression punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<ul>
<li class="">Ordinal values: These are the index numbers of the exported functions, which can be viewed in tools like <code>x64dbg</code>.</li>
</ul>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/x64-c579ea745d1dde9edb2be3a86832d338.png" style="width:100%;height:auto"></div>
<p>Write a <code>DoMagic()</code> function to display a MessageBox.
This should run in a separate thread to avoid blocking the main process:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DWORD WINAPI </span><span class="token function" style="color:#d73a49">DoMagic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LPVOID lpParameter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MessageBoxA</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Group-CK13&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Simple DLL&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MB_OK </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> MB_ICONEXCLAMATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>When the DLL is loaded (<code>DLL_PROCESS_ATTACH</code>), it creates a new thread to run <code>DoMagic()</code>:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> DLL_PROCESS_ATTACH</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    threadHandle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateThread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DoMagic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">CloseHandle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">threadHandle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>At this point, when <code>GUP.exe</code> is run again, both the original Message Box from the application and the injected (malicious) Message Box will appear.</p>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/proxy-41f564dc318311c3925a0817f77b411f.png" style="width:100%;height:auto"></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="establishing-remote-control-with-sliver-c2">Establishing remote control with Sliver C2<a href="#establishing-remote-control-with-sliver-c2" class="hash-link" aria-label="Direct link to Establishing remote control with Sliver C2" title="Direct link to Establishing remote control with Sliver C2" translate="no">​</a></h2>
<p>To escalate the attack, we can modify the <code>DoMagic()</code> function to establish a reverse shell or C2 session.
In this case, we used Sliver C2 on a Linux machine.
Once the user launches GUP.exe (e.g., by checking for updates), a session is established on the attacker&#x27;s C2 interface.</p>
<div style="width:100%;margin:0 auto"><img src="/my-small-blog/assets/images/c2-50e87282a02b29ba3c2fc013d4914c2b.png" style="width:100%;height:auto"></div>
<p>For persistence and stealth, additional techniques like process injection, registry persistence (run keys), shellcode obfuscation can be employed - though we won&#x27;t detail them here due to ethical concerns.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>DLL Side Loading is a powerful and commonly abused technique in the wild. By understanding how it works, defenders can:</p>
<ul>
<li class="">Audit how applications load DLLs</li>
<li class="">Harden directory permissions</li>
<li class="">Implement application whitelisting</li>
<li class="">Monitor abnormal DLL load behavior with tools like ProcMon</li>
</ul>
<p>From a red team or educational perspective, this hands-on walkthrough using Notepad++ shows just how easy it can be to hijack execution flow when the right conditions align.</p>
<p><em>Stay safe. Stay informed.</em></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Malware tag description" class="tag_zVej tagRegular_sFm0" href="/my-small-blog/blog/tags/malware">Malware</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/my-small-blog/blog/typed-paths"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">A deep dive into Windows TypedPaths</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/my-small-blog/blog/nt334-lab2-ctf"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Stego secrets: Extracting embedded files using HxD and dd</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#understanding-dlls-and-dll-side-loading" class="table-of-contents__link toc-highlight">Understanding DLLs and DLL Side Loading</a></li><li><a href="#tools--setup" class="table-of-contents__link toc-highlight">Tools &amp; setup</a></li><li><a href="#case-study-gupexe-in-notepad" class="table-of-contents__link toc-highlight">Case study: GUP.exe in Notepad++</a></li><li><a href="#crafting-the-first-malicious-dll" class="table-of-contents__link toc-highlight">Crafting the first malicious DLL</a></li><li><a href="#identifying-and-exporting-required-functions" class="table-of-contents__link toc-highlight">Identifying and exporting required functions</a></li><li><a href="#combining-with-dll-proxying-for-stealth-and-functionality" class="table-of-contents__link toc-highlight">Combining with DLL proxying for stealth and functionality</a></li><li><a href="#establishing-remote-control-with-sliver-c2" class="table-of-contents__link toc-highlight">Establishing remote control with Sliver C2</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Me</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-small-blog/docs/about-me">Self Introduction</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/trinh-thai-ngoc-diem-a53571208/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/trinh.thai.50364/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/tndt____" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-small-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/solivaquaant" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 @tndt, built with Docusaurus on April 25, 2025.</div></div></div></footer></div>
</body>
</html>