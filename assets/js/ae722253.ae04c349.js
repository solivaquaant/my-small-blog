"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[314],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var o=t(96540);const s={},r=o.createContext(s);function a(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(r.Provider,{value:n},e.children)}},97679:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"root-me/forensic/command-and-control-level-5","title":"Command & Control - level 5","description":"- Description: Berthier, the malware seems to be manually maintened on the workstations.","source":"@site/docs/root-me/forensic/command-and-control-level-5.mdx","sourceDirName":"root-me/forensic","slug":"/root-me/forensic/command-and-control-level-5","permalink":"/my-small-blog/docs/root-me/forensic/command-and-control-level-5","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tags":[]},"sidebar":"tutorialSidebar","previous":{"title":"Command & Control - level 4","permalink":"/my-small-blog/docs/root-me/forensic/command-and-control-level-4"},"next":{"title":"Command & Control - level 6","permalink":"/my-small-blog/docs/root-me/forensic/command-and-control-level-6/"}}');var s=t(74848),r=t(28453);const a={tags:[]},i="Command & Control - level 5",l={},c=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"command--control---level-5",children:"Command & Control - level 5"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Description:"})," Berthier, the malware seems to be manually maintened on the workstations.\r\nTherefore it's likely that the hackers have found all of the computers' passwords.\r\nSince ACME's computer fleet seems to be up to date, it's probably only due to password weakness.\r\nJohn, the system administrator doesn't believe you. Prove him wrong!\r\nFind john password."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Difficulty:"})," Medium"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,s.jsxs)(n.p,{children:["To identify user accounts present on the system, the first step involves retrieving the ",(0,s.jsx)(n.strong,{children:"hivelist"}),".\r\nSimply put, the hivelist reveals the starting memory addresses of Windows registry hives - data structures that store configuration settings and user account information."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"> ./vol2/volatility2 -f ch2.dmp --profile=Win7SP0x86 hivelist \r\nVolatility Foundation Volatility Framework 2.6\r\nVirtual    Physical   Name\r\n---------- ---------- ----\r\n0x8ee66740 0x141c0740 \\SystemRoot\\System32\\Config\\SOFTWARE\r\n0x90cab9d0 0x172ab9d0 \\SystemRoot\\System32\\Config\\DEFAULT\r\n0x9670e9d0 0x1ae709d0 \\??\\C:\\Users\\John Doe\\ntuser.dat\r\n0x9670f9d0 0x04a719d0 \\??\\C:\\Users\\John Doe\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat\r\n//highlight-next-line\r\n0x9aad6148 0x131af148 \\SystemRoot\\System32\\Config\\SAM\r\n0x9ab25008 0x14a61008 \\SystemRoot\\System32\\Config\\SECURITY\r\n0x9aba79d0 0x11a259d0 \\??\\C:\\Windows\\ServiceProfiles\\LocalService\\NTUSER.DAT\r\n0x9abb1720 0x0a7d4720 \\??\\C:\\Windows\\ServiceProfiles\\NetworkService\\NTUSER.DAT\r\n0x8b20c008 0x039e1008 [no name]\r\n//highlight-next-line\r\n0x8b21c008 0x039ef008 \\REGISTRY\\MACHINE\\SYSTEM\r\n0x8b23c008 0x02ccf008 \\REGISTRY\\MACHINE\\HARDWARE\r\n0x8ee66008 0x141c0008 \\Device\\HarddiskVolume1\\Boot\\BCD\n"})}),"\n",(0,s.jsxs)(n.p,{children:["From the hivelist output, we obtain a list of registry keys related to Windows user account management that are currently loaded into RAM.\r\nThe next step is to locate the password hashes by referencing two specific keys: the ",(0,s.jsx)(n.strong,{children:"SYSTEM"})," key and the ",(0,s.jsx)(n.strong,{children:"SAM"})," key.\r\nIn the results, each entry typically includes three columns: ",(0,s.jsx)(n.strong,{children:"Virtual"}),", ",(0,s.jsx)(n.strong,{children:"Physical"}),", ",(0,s.jsx)(n.strong,{children:"Name"}),".\r\nBy inspecting the ",(0,s.jsx)(n.strong,{children:"Name"})," column, we can identify:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The SYSTEM key: ",(0,s.jsx)(n.code,{children:"\\REGISTRY\\MACHINE\\SYSTEM"})]}),"\n",(0,s.jsxs)(n.li,{children:["The SAM key: ",(0,s.jsx)(n.code,{children:"\\SystemRoot\\System32\\Config\\SAM"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["We then extract the corresponding ",(0,s.jsx)(n.strong,{children:"Virtual"})," addresses of these 2 entries and insert them into the following command to extract the password hashes:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./vol2/volatility2 -f ch2.dmp --profile=Win7SP0x86 hashdump -y 0x8b21c008 -s 0x9aad6148 > hash.txt\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command outputs the hash data into a text file for easier analysis."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\r\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\r\nJohn Doe:1000:aad3b435b51404eeaad3b435b51404ee:b9f917853e3dbf6e6831ecce60725930:::\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each record in the file is structured using the following colon-separated format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"<Username>:<User ID>:<LM hash>:<NT hash>:<Comment>:<Home Dir>:\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For example, for the user ",(0,s.jsx)(n.strong,{children:"John Doe"}),", we obtain the NT hash (",(0,s.jsx)(n.code,{children:"b9f917853e3dbf6e6831ecce60725930"}),") in MD5 format.\r\nUse ",(0,s.jsx)(n.a,{href:"https://md5decrypt.net/",children:"this tool"})," to decrypt the hash, which reveals the password as ",(0,s.jsx)(n.code,{children:"passw0rd"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"passw0rd"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);