"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[8645],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var r=t(96540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},54539:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"pico-ctf/forensics/event-viewing","title":"Event-Viewing","description":"- Description: One of the employees at your company has their computer infected by malware!","source":"@site/docs/pico-ctf/forensics/event-viewing.mdx","sourceDirName":"pico-ctf/forensics","slug":"/pico-ctf/forensics/event-viewing","permalink":"/my-small-blog/docs/pico-ctf/forensics/event-viewing","draft":false,"unlisted":false,"tags":[{"inline":false,"label":"Forensics","permalink":"/my-small-blog/docs/tags/forensics","description":"Forensics tag description"}],"version":"current","frontMatter":{"tags":["forensics"]},"sidebar":"tutorialSidebar","previous":{"title":"Enhance!","permalink":"/my-small-blog/docs/pico-ctf/forensics/enhance"},"next":{"title":"extensions","permalink":"/my-small-blog/docs/pico-ctf/forensics/extensions/"}}');var a=t(74848),i=t(28453);const o={tags:["forensics"]},s="Event-Viewing",l={},c=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"Action 1: Software installation",id:"action-1-software-installation",level:3},{value:"Action 2: Program execution",id:"action-2-program-execution",level:3},{value:"Action 3: System reboot",id:"action-3-system-reboot",level:3},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"event-viewing",children:"Event-Viewing"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Description:"})," One of the employees at your company has their computer infected by malware!\r\nTurns out every time they try to switch on the computer, it shuts down right after they log in.\r\nThe story given by the employee is as follows:"]}),"\n"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"They installed software using an installer they downloaded online"}),"\n",(0,a.jsx)(n.li,{children:"They ran the installed software but it seemed to do nothing"}),"\n",(0,a.jsx)(n.li,{children:"Now every time they bootup and login to their computer, a black command prompt screen quickly opens and closes and their computer shuts down instantly.\r\nSee if you can find evidence for the each of these events and retrieve the flag (split into 3 pieces) from the correct logs!"}),"\n"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Difficulty:"})," Medium"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,a.jsxs)(n.p,{children:["We were provided with the ",(0,a.jsx)(n.code,{children:"Windows_Logs.evtx"})," file - a native Windows Event Log file.\r\nTo make the log data more accessible and easier to parse, we first converted the ",(0,a.jsx)(n.code,{children:".evtx"})," file into ",(0,a.jsx)(n.code,{children:".xml"})," format\r\n(it's also fully viewable using the built-in ",(0,a.jsx)(n.strong,{children:"Event Viewer"})," in Windows)"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from Evtx.Evtx import Evtx\r\n\r\ndef parse_evtx_file(file_path, output_file):\r\n    try:\r\n        with Evtx(file_path) as log:\r\n            xml_records = [record.xml() for record in log.records()]\r\n        with open(output_file, "w", encoding="utf-8") as f:\r\n            f.write("<Events>\\n")\r\n            for rec in xml_records:\r\n                f.write(rec + "\\n")\r\n            f.write("</Events>")\r\n        print(f"[+] Successfully saved to: {output_file}")\r\n\r\n    except FileNotFoundError:\r\n        print("[!] Error: File not found. Please check the file path and try again.")\r\n    except Exception as e:\r\n        print(f"[!] An unexpected error occurred: {e}")\r\n\r\nif __name__ == "__main__":\r\n    evtx_file = "Windows_Logs.evtx"\r\n    output_xml = "result.xml"\r\n    parse_evtx_file(evtx_file, output_xml)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"action-1-software-installation",children:"Action 1: Software installation"}),"\n",(0,a.jsxs)(n.p,{children:["Our investigation begins with Event ID ",(0,a.jsx)(n.strong,{children:"1033"}),", which records the installation of a program named ",(0,a.jsx)(n.strong,{children:"Totally Legit Software"})," - though its legitimacy is questionable at best."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"><System><Provider Name="MsiInstaller"></Provider>\r\n<EventID Qualifiers="0">1033</EventID>\r\n<Version>0</Version>\r\n<Level>4</Level>\r\n<Task>0</Task>\r\n<Opcode>0</Opcode>\r\n<Keywords>0x0080000000000000</Keywords>\r\n<TimeCreated SystemTime="2024-07-15 15:55:57.729797+00:00"></TimeCreated>\r\n<EventRecordID>2373</EventRecordID>\r\n<Correlation ActivityID="" RelatedActivityID=""></Correlation>\r\n<Execution ProcessID="0" ThreadID="0"></Execution>\r\n<Channel>Application</Channel>\r\n<Computer>DESKTOP-EKVR84B</Computer>\r\n<Security UserID="S-1-5-21-3576963320-1344788273-4164204335-1001"></Security>\r\n</System>\r\n//highlight-next-line\r\n<EventData><Data>&lt;string&gt;Totally_Legit_Software&lt;/string&gt;\r\n&lt;string&gt;1.3.3.7&lt;/string&gt;\r\n&lt;string&gt;0&lt;/string&gt;\r\n&lt;string&gt;0&lt;/string&gt;\r\n//highlight-next-line\r\n&lt;string&gt;cGljb0NURntFdjNudF92aTN3djNyXw==&lt;/string&gt;\r\n&lt;string&gt;(NULL)&lt;/string&gt;\r\n&lt;string&gt;&lt;/string&gt;\r\n</Data>\r\n<Binary>ezNEM0MzODMzLURFRDYtNDAyMi1CNUExLUU3RjM3Nzg5QzM5MH0wMDAwNzY1MzdiOTcwMjM5ZjlhMDc1MGM0MWI4ODY0ZmRhYzkwMDAwMDAwMA==</Binary>\r\n</EventData>\r\n</Event>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Embedded within the log is a suspicious Base64-encoded string.\r\nDecoded, it reveals the beginning of a flag: ",(0,a.jsx)(n.code,{children:"picoCTF{Ev3nt_vi3wv3r_"})]}),"\n",(0,a.jsx)(n.h3,{id:"action-2-program-execution",children:"Action 2: Program execution"}),"\n",(0,a.jsxs)(n.p,{children:["Next, Event ID ",(0,a.jsx)(n.strong,{children:"4657"})," indicates a possible registry modification - a common tactic used by malicious software to persist on a system.\r\nThe changes appear to reference a shutdown utility named ",(0,a.jsx)(n.code,{children:"custom_shutdown.exe"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"><System><Provider Name="Microsoft-Windows-Security-Auditing" Guid="{54849625-5478-4994-a5ba-3e3b0328c30d}"></Provider>\r\n<EventID Qualifiers="">4657</EventID>\r\n<Version>0</Version>\r\n<Level>0</Level>\r\n<Task>12801</Task>\r\n<Opcode>0</Opcode>\r\n<Keywords>0x8020000000000000</Keywords>\r\n<TimeCreated SystemTime="2024-07-15 15:56:19.103197+00:00"></TimeCreated>\r\n<EventRecordID>168656</EventRecordID>\r\n<Correlation ActivityID="" RelatedActivityID=""></Correlation>\r\n<Execution ProcessID="4" ThreadID="1084"></Execution>\r\n<Channel>Security</Channel>\r\n<Computer>DESKTOP-EKVR84B</Computer>\r\n<Security UserID=""></Security>\r\n</System>\r\n<EventData><Data Name="SubjectUserSid">S-1-5-21-3576963320-1344788273-4164204335-1001</Data>\r\n<Data Name="SubjectUserName">user</Data>\r\n<Data Name="SubjectDomainName">DESKTOP-EKVR84B</Data>\r\n<Data Name="SubjectLogonId">0x000000000005a428</Data>\r\n<Data Name="ObjectName">\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run</Data>\r\n//highlight-next-line\r\n<Data Name="ObjectValueName">Immediate Shutdown (MXNfYV9wcjN0dHlfdXMzZnVsXw==)</Data>\r\n<Data Name="HandleId">0x0000000000000208</Data>\r\n<Data Name="OperationType">%%1904</Data>\r\n<Data Name="OldValueType">-</Data>\r\n<Data Name="OldValue">-</Data>\r\n<Data Name="NewValueType">%%1873</Data>\r\n<Data Name="NewValue">C:\\Program Files (x86)\\Totally_Legit_Software\\custom_shutdown.exe</Data>\r\n<Data Name="ProcessId">0x0000000000001bd0</Data>\r\n<Data Name="ProcessName">C:\\Program Files (x86)\\Totally_Legit_Software\\Totally_Legit_Software.exe</Data>\r\n</EventData>\r\n</Event>\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Another Base64 string is found, decoded to ",(0,a.jsx)(n.code,{children:"1s_a_pr3tty_us3ful_"})]}),"\n",(0,a.jsx)(n.h3,{id:"action-3-system-reboot",children:"Action 3: System reboot"}),"\n",(0,a.jsxs)(n.p,{children:["Examining Event ID ",(0,a.jsx)(n.strong,{children:"1074"}),", we observe two shutdown events:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The first initiated by the legitimate ",(0,a.jsx)(n.code,{children:"RuntimeBroker.exe"})," process."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"><System><Provider Name="User32" Guid="{b0aa8734-56f7-41cc-b2f4-de228e98b946}" EventSourceName="User32"></Provider>\r\n<EventID Qualifiers="32768">1074</EventID>\r\n<Version>0</Version>\r\n<Level>4</Level>\r\n<Task>0</Task>\r\n<Opcode>0</Opcode>\r\n<Keywords>0x8080000000000000</Keywords>\r\n<TimeCreated SystemTime="2024-07-15 16:46:14.079933+00:00"></TimeCreated>\r\n<EventRecordID>3668</EventRecordID>\r\n<Correlation ActivityID="" RelatedActivityID=""></Correlation>\r\n<Execution ProcessID="436" ThreadID="564"></Execution>\r\n<Channel>System</Channel>\r\n<Computer>DESKTOP-EKVR84B</Computer>\r\n<Security UserID="S-1-5-21-3576963320-1344788273-4164204335-1001"></Security>\r\n</System>\r\n//highlight-next-line\r\n<EventData><Data Name="param1">C:\\Windows\\System32\\RuntimeBroker.exe (DESKTOP-EKVR84B)</Data>\r\n<Data Name="param2">DESKTOP-EKVR84B</Data>\r\n<Data Name="param3">Other (Unplanned)</Data>\r\n<Data Name="param4">0x0</Data>\r\n<Data Name="param5">restart</Data>\r\n<Data Name="param6"></Data>\r\n<Data Name="param7">DESKTOP-EKVR84B\\user</Data>\r\n</EventData>\r\n</Event>\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Shortly after, a forced reboot triggered by ",(0,a.jsx)(n.code,{children:"custom_shutdown.exe"}),". This second event contains the final Base64 fragment, decode and we have ",(0,a.jsx)(n.code,{children:"t00l_81ba3fe9}"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event"><System><Provider Name="User32" Guid="{b0aa8734-56f7-41cc-b2f4-de228e98b946}" EventSourceName="User32"></Provider>\r\n<EventID Qualifiers="32768">1074</EventID>\r\n<Version>0</Version>\r\n<Level>4</Level>\r\n<Task>0</Task>\r\n<Opcode>0</Opcode>\r\n<Keywords>0x8080000000000000</Keywords>\r\n<TimeCreated SystemTime="2024-07-15 17:01:05.393583+00:00"></TimeCreated>\r\n<EventRecordID>3801</EventRecordID>\r\n<Correlation ActivityID="" RelatedActivityID=""></Correlation>\r\n<Execution ProcessID="432" ThreadID="3496"></Execution>\r\n<Channel>System</Channel>\r\n<Computer>DESKTOP-EKVR84B</Computer>\r\n<Security UserID="S-1-5-21-3576963320-1344788273-4164204335-1001"></Security>\r\n</System>\r\n//highlight-next-line\r\n<EventData><Data Name="param1">C:\\Windows\\system32\\shutdown.exe (DESKTOP-EKVR84B)</Data>\r\n<Data Name="param2">DESKTOP-EKVR84B</Data>\r\n<Data Name="param3">No title for this reason could be found</Data>\r\n<Data Name="param4">0x800000ff</Data>\r\n<Data Name="param5">shutdown</Data>\r\n//highlight-next-line\r\n<Data Name="param6">dDAwbF84MWJhM2ZlOX0=</Data>\r\n<Data Name="param7">DESKTOP-EKVR84B\\user</Data>\r\n</EventData>\r\n</Event>\n'})}),"\n",(0,a.jsx)(n.p,{children:"Combining the 3 decoded parts, we recover the complete flag."}),"\n",(0,a.jsx)(n.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"picoCTF{Ev3nt_vi3wv3r_1s_a_pr3tty_us3ful_t00l_81ba3fe9}"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);