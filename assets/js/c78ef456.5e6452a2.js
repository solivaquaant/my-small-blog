"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[2043],{11512:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"pico-ctf/general-skills/flag_shop","title":"flag_shop","description":"- Description: There\'s a flag shop selling stuff, can you buy a flag?","source":"@site/docs/pico-ctf/general-skills/flag_shop.mdx","sourceDirName":"pico-ctf/general-skills","slug":"/pico-ctf/general-skills/flag_shop","permalink":"/my-small-blog/docs/pico-ctf/general-skills/flag_shop","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tags":[]},"sidebar":"tutorialSidebar","previous":{"title":"fixme2.py","permalink":"/my-small-blog/docs/pico-ctf/general-skills/fixme2"},"next":{"title":"Glitch Cat","permalink":"/my-small-blog/docs/pico-ctf/general-skills/glitch-cat"}}');var s=l(74848),r=l(28453);const c={tags:[]},o="flag_shop",a={},i=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function h(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"flag_shop",children:"flag_shop"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Description:"})," There's a flag shop selling stuff, can you buy a flag?"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Difficulty:"})," Medium"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,s.jsx)(n.p,{children:"This challenge presents us with a flag shop menu featuring three options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Welcome to the flag exchange\r\nWe sell flags\r\n1. Check Account Balance\r\n2. Buy Flags\r\n3. Exit\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Checking the account balance shows a starting value of ",(0,s.jsx)(n.code,{children:"1100"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Enter a menu selection\r\n1\r\nBalance: 1100\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Choosing the ",(0,s.jsx)(n.strong,{children:"Buy flag"})," option reveals 2 purchasable items:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Currently for sale\r\n1. Defintely not the flag Flag\r\n2. 1337 Flag\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Definitely not the flag Flag"})," priced at ",(0,s.jsx)(n.code,{children:"900"}),", where we can specify the quantity."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"1337 Flag"})," priced at ",(0,s.jsx)(n.code,{children:"100 000"}),", which is initially out of reach due to insufficient funds."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Our goal is to somehow manipulate the balance in order to purchase the coveted ",(0,s.jsx)(n.strong,{children:"1337 Flag"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Looking at the provided source code, we notice the following:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["A variable ",(0,s.jsx)(n.code,{children:"total_cost"})," (a signed integer) is initialized to ",(0,s.jsx)(n.code,{children:"0"})," and later calculated as ",(0,s.jsx)(n.code,{children:"900 * number_flags"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"int number_flags = 0;\r\n\r\nif(number_flags > 0){\r\n    int total_cost = 0;\r\n    total_cost = 900*number_flags;\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Since both ",(0,s.jsx)(n.code,{children:"total_cost"})," and the balance are signed integers, the program is vulnerable to ",(0,s.jsx)(n.strong,{children:"integer overflow"}),".\r\nIf ",(0,s.jsx)(n.code,{children:"total_cost"})," overflows into a negative value, the comparison ",(0,s.jsx)(n.code,{children:"total_cost <= account_balance"})," will trivially succeed, and subtracting a negative number will effectively increase the account balance instead of decreasing it."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:'if(total_cost <= account_balance){\r\n    account_balance = account_balance - total_cost;\r\n    printf("\\nYour current balance after transaction: %d\\n\\n", account_balance);\r\n    }\r\n    else{\r\n        printf("Not enough funds to complete purchase\\n");\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Integer overflow"})," occurs when an arithmetic operation produces a result that lies outside the representable range of the chosen data type.\r\nFor a signed 32-bit integer, the valid range is from ",(0,s.jsx)(n.code,{children:"-2 147 483 648"})," to ",(0,s.jsx)(n.code,{children:"2 147 483 647"}),'.\r\nIf a computation exceeds this boundary, the value "wraps around" to the opposite end of the range.']}),"\n",(0,s.jsxs)(n.p,{children:["Suppose we try to purchase ",(0,s.jsx)(n.strong,{children:"4 000 000"}),' units of "Definitely not the flag Flag".']}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The computed ",(0,s.jsx)(n.code,{children:"total_cost"})," becomes ",(0,s.jsx)(n.code,{children:"-694967296"})," due to overflow."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Currently for sale\r\n1. Defintely not the flag Flag\r\n2. 1337 Flag\r\n1\r\nThese knockoff Flags cost 900 each, enter desired quantity\r\n4000000\r\n\r\nThe final cost is: -694967296\r\n\r\nYour current balance after transaction: 694968396\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The program then updates the balance as:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"account_balance = account_balance - total_cost\r\n= 1100 - (-694967296)\r\n= 694968396\n"})}),"\n",(0,s.jsxs)(n.p,{children:["With nearly 695 million in our account, we can now afford the ",(0,s.jsx)(n.strong,{children:"1337 Flag"})," and successfully obtain the challenge flag."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1337 flags cost 100000 dollars, and we only have 1 in stock\r\nEnter 1 to buy one\r\n1\r\nYOUR FLAG IS: picoCTF{m0n3y_bag5_65d67a74}\r\nWelcome to the flag exchange\n"})}),"\n",(0,s.jsx)(n.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"picoCTF{m0n3y_bag5_65d67a74}"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,l)=>{l.d(n,{R:()=>c,x:()=>o});var t=l(96540);const s={},r=t.createContext(s);function c(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);