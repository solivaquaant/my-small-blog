"use strict";(self.webpackChunkmy_own_blog=self.webpackChunkmy_own_blog||[]).push([[1898],{2065:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/image-c946574a0e00981a91f8a5ebf1898ca9.png"},3050:(e,r,n)=>{n.d(r,{A:()=>t});const t=n.p+"assets/images/flag-1d2caa5efff4f4fcb15247b929193d5a.png"},6115:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"pico-ctf/reverse-engineering/droids4/droids4","title":"droids4","description":"- Description: Reverse the pass, patch the file, get the flag. Check out this file.","source":"@site/docs/pico-ctf/reverse-engineering/droids4/droids4.mdx","sourceDirName":"pico-ctf/reverse-engineering/droids4","slug":"/pico-ctf/reverse-engineering/droids4/","permalink":"/my-small-blog/docs/pico-ctf/reverse-engineering/droids4/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"tags":[]},"sidebar":"tutorialSidebar","previous":{"title":"droids3","permalink":"/my-small-blog/docs/pico-ctf/reverse-engineering/droids3/"}}');var i=n(4848),a=n(8453);const s={tags:[]},l="droids4",c={},o=[{value:"\ud83d\udd0e Solution",id:"-solution",level:2},{value:"\ud83d\udea9Flag",id:"flag",level:2}];function d(e){const r={a:"a",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"droids4",children:"droids4"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Description:"})," Reverse the pass, patch the file, get the flag. Check out this file."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Difficulty:"})," Hard"]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-solution",children:"\ud83d\udd0e Solution"}),"\n",(0,i.jsxs)(r.p,{children:["Open the APK file using Bytecode Viewer.\r\nInside the ",(0,i.jsx)(r.code,{children:"FlagstaffHill.class"}),", we observe several variables being initialized and manipulated.\r\nThe program prints ",(0,i.jsx)(r.strong,{children:'"call it"'})," when the correct input string is entered. To extract the flag, we need to:"]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Identify the correct input string."}),"\n",(0,i.jsxs)(r.li,{children:["Modify the code to replace the ",(0,i.jsx)(r.strong,{children:'"call it"'})," response with a call to the ",(0,i.jsx)(r.code,{children:"cardamom()"})," method, which reveals the flag."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:'public static native String cardamom(String var0);\r\n\r\npublic static String getFlag(String var0, Context var1) {\r\n  StringBuilder var2 = new StringBuilder("aaa");\r\n  StringBuilder var5 = new StringBuilder("aaa");\r\n  StringBuilder var3 = new StringBuilder("aaa");\r\n  StringBuilder var4 = new StringBuilder("aaa");\r\n  var2.setCharAt(0, (char)(var2.charAt(0) + 4));\r\n  var2.setCharAt(1, (char)(var2.charAt(1) + 19));\r\n  var2.setCharAt(2, (char)(var2.charAt(2) + 18));\r\n  var5.setCharAt(0, (char)(var5.charAt(0) + 7));\r\n  var5.setCharAt(1, (char)(var5.charAt(1) + 0));\r\n  var5.setCharAt(2, (char)(var5.charAt(2) + 1));\r\n  var3.setCharAt(0, (char)(var3.charAt(0) + 0));\r\n  var3.setCharAt(1, (char)(var3.charAt(1) + 11));\r\n  var3.setCharAt(2, (char)(var3.charAt(2) + 15));\r\n  var4.setCharAt(0, (char)(var4.charAt(0) + 14));\r\n  var4.setCharAt(1, (char)(var4.charAt(1) + 20));\r\n  var4.setCharAt(2, (char)(var4.charAt(2) + 15));\r\n  return var0.equals("".concat(var3.toString()).concat(var5.toString()).concat(var2.toString()).concat(var4.toString())) ? "call it" : "NOPE";\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:'Several variables are initialized with "aaa" and then transformed:'}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"var2:"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"'a' + 4 = 'e'"}),"\n",(0,i.jsx)(r.li,{children:"'a' + 19 = 't'"}),"\n",(0,i.jsxs)(r.li,{children:["'a' + 18 = 's'",(0,i.jsx)(r.br,{}),"\n",'\u2192 var2 = "ets"']}),"\n"]}),"\n",(0,i.jsxs)(r.ol,{start:"2",children:["\n",(0,i.jsx)(r.li,{children:"var3:"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"'a' + 7 = 'h'"}),"\n",(0,i.jsx)(r.li,{children:"'a' + 0 = 'a'"}),"\n",(0,i.jsxs)(r.li,{children:["'a' + 1 = 'b'",(0,i.jsx)(r.br,{}),"\n",'\u2192 var3 = "hab"']}),"\n"]}),"\n",(0,i.jsxs)(r.ol,{start:"3",children:["\n",(0,i.jsx)(r.li,{children:"var5:"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"'a' + 0 = 'a'"}),"\n",(0,i.jsx)(r.li,{children:"'a' + 11 = 'l'"}),"\n",(0,i.jsxs)(r.li,{children:["'a' + 15 = 'p'",(0,i.jsx)(r.br,{}),"\n",'\u2192 var5 = "alp"']}),"\n"]}),"\n",(0,i.jsxs)(r.ol,{start:"4",children:["\n",(0,i.jsx)(r.li,{children:"var4:"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"'a' + 14 = 'o'"}),"\n",(0,i.jsx)(r.li,{children:"'a' + 20 = 'u'"}),"\n",(0,i.jsxs)(r.li,{children:["'a' + 15 = 'p'",(0,i.jsx)(r.br,{}),"\n",'\u2192   var4 = "oup"']}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:['Combining the variables: "alp" + "hab" + "ets" + "oup" \u2192 ',(0,i.jsx)(r.code,{children:"alphabetsoup"})]}),"\n",(0,i.jsx)("div",{style:{width:"50%",margin:"0 auto"},children:(0,i.jsx)("img",{src:n(2065).A,style:{width:"100%",height:"auto"}})}),"\n",(0,i.jsxs)(r.p,{children:["Edit smali code by locating the line that returns ",(0,i.jsx)(r.code,{children:'"call it"'})," and replace it with a call to the ",(0,i.jsx)(r.code,{children:"cardamom()"})," function."]}),"\n",(0,i.jsx)(r.p,{children:"Replace the following code:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:'if-eqz v5, :cond_0\r\n\r\nconst-string v5, "call it"\r\n\r\nreturn-object v5\n'})}),"\n",(0,i.jsx)(r.p,{children:"with"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"if-eqz v5, :cond_0\r\n\r\ninvoke-static {p0}, Lcom/hellocmu/picoctf/FlagstaffHill;->cardamom(Ljava/lang/String;)Ljava/lang/String;\r\nmove-result-object v5\r\n\r\nreturn-object v5\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Recompile the APK, generate a keystore and sign the APK, and reinstall the modified app (you can see details how to do this in the ",(0,i.jsx)(r.a,{href:"https://solivaquaant.github.io/my-small-blog/docs/pico-ctf/reverse-engineering/droids3/",children:"previous droids"})," writeup).\r\nNow, when ",(0,i.jsx)(r.code,{children:"alphabetsoup"})," is entered, the app executes the patched logic and reveals the flag."]}),"\n",(0,i.jsx)("div",{style:{width:"50%",margin:"0 auto"},children:(0,i.jsx)("img",{src:n(3050).A,style:{width:"100%",height:"auto"}})}),"\n",(0,i.jsx)(r.h2,{id:"flag",children:"\ud83d\udea9Flag"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.code,{children:"picoCTF{not.particularly.silly}"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>l});var t=n(6540);const i={},a=t.createContext(i);function s(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);