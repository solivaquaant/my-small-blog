"use strict";(globalThis.webpackChunkmy_own_blog=globalThis.webpackChunkmy_own_blog||[]).push([[2250],{11065:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"sysmon-splunk/rdp-brute-force/rdp-brute-force","title":"Detecting RDP brute-force attacks","description":"Overview","source":"@site/labs/sysmon-splunk/rdp-brute-force/rdp-brute-force.mdx","sourceDirName":"sysmon-splunk/rdp-brute-force","slug":"/sysmon-splunk/rdp-brute-force/","permalink":"/labs/sysmon-splunk/rdp-brute-force/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"labsSidebar","previous":{"title":"Investigating suspicious PowerShell activity","permalink":"/labs/sysmon-splunk/powershell/"},"next":{"title":"Tracking suspicious Windows Registry changes","permalink":"/labs/sysmon-splunk/registry/"}}');var s=r(74848),o=r(28453);const i={},a="Detecting RDP brute-force attacks",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Execution steps",id:"execution-steps",level:2},{value:"Configure the Windowstarget to accept RDP connections",id:"configure-the-windowstarget-to-accept-rdp-connections",level:3},{value:"Validate RDP port availability from Kali",id:"validate-rdp-port-availability-from-kali",level:3},{value:"Execute a brute-force attack using Hydra",id:"execute-a-brute-force-attack-using-hydra",level:3},{value:"Log analysis in Splunk",id:"log-analysis-in-splunk",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"detecting-rdp-brute-force-attacks",children:"Detecting RDP brute-force attacks"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Remote Desktop Protocol (RDP)"})," is a common attack vector for brute-force attempts due to its widespread use in enterprise environments.\r\nThis blog post demonstrates how to simulate an RDP brute-force attack using Hydra from Kali Linux against a Windows target, and how to detect such attempts using Sysmon and Splunk.\r\nWe'll walk through configuring the environment, executing the attack, and analyzing the resulting logs for forensic and detection purposes."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"execution-steps",children:"Execution steps"}),"\n",(0,s.jsx)(n.h3,{id:"configure-the-windowstarget-to-accept-rdp-connections",children:"Configure the Windowstarget to accept RDP connections"}),"\n",(0,s.jsxs)(n.p,{children:["Allow ICMP (",(0,s.jsx)(n.code,{children:"ping"}),") and RDP through the Windows Firewall:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'netsh advfirewall firewall add rule name="Allow ICMPv4-In" protocol=icmpv4:8,any dir=in action=allow\r\nnetsh advfirewall firewall add rule name="Allow RDP-In" protocol=TCP localport=3389 dir=in action=allow\n'})}),"\n",(0,s.jsxs)(n.p,{children:["These commands enable ICMP Echo Request (ping) and allow inbound RDP traffic on port ",(0,s.jsx)(n.strong,{children:"3389"}),", which is the default for Remote Desktop."]}),"\n",(0,s.jsx)(n.p,{children:"Check RDP Service Status, if the returned value is 1, RDP is disabled."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Get-ItemProperty -Path 'HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\' -Name \"fDenyTSConnections\"\n"})}),"\n",(0,s.jsx)(n.p,{children:"Enable RDP and necessary firewall rules:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'Set-ItemProperty -Path \'HKLM:\\System\\CurrentControlSet\\Control\\Terminal Server\\\' -Name "fDenyTSConnections" -Value 0\r\nEnable-NetFirewallRule -DisplayGroup "Remote Desktop"\n'})}),"\n",(0,s.jsx)(n.p,{children:"This enables RDP access and ensures firewall rules are active to allow incoming connections."}),"\n",(0,s.jsx)(n.h3,{id:"validate-rdp-port-availability-from-kali",children:"Validate RDP port availability from Kali"}),"\n",(0,s.jsxs)(n.p,{children:["On Kali Linux, run an ",(0,s.jsx)(n.code,{children:"nmap"})," scan:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nmap -p 3389 <victim_ip>\n"})}),"\n",(0,s.jsx)(n.p,{children:"If the port shows as open, RDP is reachable. If it shows filtered or closed, RDP may still be blocked by firewall or not properly enabled."}),"\n",(0,s.jsx)(n.h3,{id:"execute-a-brute-force-attack-using-hydra",children:"Execute a brute-force attack using Hydra"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"hydra -V -f -l <username> -P <path_to_wordlist> rdp://<victim_ip>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Explanation of the command:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"V"}),": verbose output, shows each attempt"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"f"}),": stop after the first valid login is found"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"l <username>"}),": username to brute-force"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"P <path_to_wordlist>"}),": list of passwords to try"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"rdp://<victim_ip>"}),": target service and IP\r\nThis simulates an attacker trying to gain RDP access by guessing passwords for the user."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"log-analysis-in-splunk",children:"Log analysis in Splunk"}),"\n",(0,s.jsxs)(n.p,{children:["To detect brute-force attempts, we rely on Sysmon ",(0,s.jsx)(n.code,{children:"Event ID 3"}),", which logs network connections.\r\nThese are essential for identifying repeated unauthorized access attempts to sensitive ports like ",(0,s.jsx)(n.strong,{children:"3389"})," (RDP)."]}),"\n",(0,s.jsx)(n.p,{children:"SPL query to detect RDP connections:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'index="sysmon_logs" sourcetype=XmlWinEventLog:Sysmon DestinationPort=3389\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This query filters for all outbound or inbound connections on port ",(0,s.jsx)(n.strong,{children:"3389"}),", the standard port for RDP.\r\nIt's useful for identifying the source IPs attempting RDP access."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Log from Splunk:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"07/25/2025 08:53:12 AM\r\nLogName=Microsoft-Windows-Sysmon/Operational\r\nEventCode=3\r\nEventType=4\r\nComputerName=DESKTOP-R6K3C8S\r\nUser=NOT_TRANSLATED\r\nSid=S-1-5-18\r\nSidType=0\r\nSourceName=Microsoft-Windows-Sysmon\r\nType=Information\r\nRecordNumber=8633\r\nKeywords=None\r\nTaskCategory=Network connection detected (rule: NetworkConnect)\r\nOpCode=Info\r\nMessage=Network connection detected:\r\nRuleName: RDP\r\nUtcTime: 2025-07-25 14:39:11.827\r\nProcessGuid: {d6c4500c-a83d-6883-150a-000000000700}\r\nProcessId: 4004\r\nImage: C:\\Windows\\System32\\svchost.exe\r\nUser: NT AUTHORITY\\NETWORK SERVICE\r\nProtocol: tcp\r\nInitiated: false\r\nSourceIsIpv6: false\r\nSourceIp: 192.168.200.5\r\nSourceHostname: -\r\nSourcePort: 39954\r\nSourcePortName: -\r\nDestinationIsIpv6: false\r\nDestinationIp: 192.168.200.4\r\nDestinationHostname: DESKTOP-R6K3C8S.localdomain\r\nDestinationPort: 3389\r\nDestinationPortName: ms-wbt-server\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Event description:"})," A connection was detected from a remote IP (",(0,s.jsx)(n.code,{children:"192.168.200.5"}),", Kali Linux) to the RDP service on the Windows host (",(0,s.jsx)(n.code,{children:"192.168.200.4"}),") using TCP on port ",(0,s.jsx)(n.strong,{children:"3389"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var t=r(96540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);